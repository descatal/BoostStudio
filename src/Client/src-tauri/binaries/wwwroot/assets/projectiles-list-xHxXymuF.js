import{j as e,b as u,S as p,a1 as m,ag as D,ah as z,ai as H,aj as M,ak as A,L as U,k as E,a2 as F,aG as I,aH as k}from"./index-_vJHe0oM.js";import{C as L,b as R,c as O,d as B,a as K}from"./card-5a8OwMZI.js";import{c as V,p as b,h as q,f as Q,g as Z,w,m as G,n as W,o as _,q as J,r as X,s as Y,t as $,v as ee,D as se,P as ae,u as te,i as ie,j as re}from"./react-icons.esm-CMH9-wE8.js";import{H as C}from"./hash-input-BmZZ7wAd.js";import{A as ne,Z as oe,S as le,a as ce,b as de,c as he,d as me,e as xe,f as ue,g as pe,L as P}from"./AutoForm-Ct6SXXji.js";import{u as je}from"./use-media-query-DN786i_c.js";import{u as j}from"./useMutation-0UaTLUn9.js";import{y as ge,z as fe,A as be,g as Ce,B as Pe}from"./react-query.gen-KD5ZsEyq.js";import{E as g}from"./enhanced-button-CUT0MAbl.js";import{u as S}from"./useQuery-BdyAwn5H.js";import{h as Se}from"./columns-BlpQJy-L.js";import{I as ye}from"./icons-stbk7nY0.js";import{M as ve,S as we}from"./index-MRitm8At.js";import{C as Ne,a as Te,B as y,b as De,c as ze,d as He,h as Me,e as Ae,f as Ue}from"./index-CH22QDEB.js";import{L as Ee}from"./label-5eQ_BX-X.js";import{U as Fe}from"./units-selector-CW0f3RqB.js";const Ie={...q,hashes:b(Z),unitIds:b(Q)},ke={hashes:"hash",unitIds:"unitId"},Le=V(Ie,{urlKeys:ke}),Re=new oe(w),v=({data:s,onSubmit:a,children:o})=>e.jsx(ne,{schema:Re,defaultValues:s,onSubmit:t=>{a(s?{...t,hash:t.hash}:t)},formProps:{className:"px-2 overflow-auto"},withSubmit:!o,children:o}),N=({data:s,triggerButton:a,...o})=>{const[t,d]=u.useState(!1),c=j({...ge(),onSuccess:()=>()=>d(!1)}),r=j({...fe(),onSuccess:()=>()=>d(!1)}),l=c.isPending||r.isPending,i=n=>{s?r.mutate({path:{hash:n.hash},body:n}):c.mutate({body:n})};return je("(min-width: 640px)")?e.jsxs(le,{open:t,onOpenChange:d,...o,children:[e.jsx(ce,{asChild:!0,children:a??e.jsx(e.Fragment,{})}),e.jsxs(de,{className:"flex flex-col gap-6 sm:max-w-md",children:[e.jsxs(he,{className:"text-left",children:[e.jsx(me,{children:s?"Update":"Create"}),e.jsxs(xe,{children:[s?"Update existing":"Create new"," entry"]})]}),e.jsx(p,{}),e.jsx(v,{data:s,onSubmit:i,children:e.jsxs(ue,{className:"gap-2 pt-2 sm:space-x-0",children:[e.jsx(pe,{asChild:!0,children:e.jsx(m,{type:"button",variant:"outline",children:"Cancel"})}),e.jsxs(m,{disabled:l,children:[l&&e.jsx(P,{className:"mr-2 size-4 animate-spin","aria-hidden":"true"}),"Save"]})]})})]})]}):e.jsxs(G,{open:t,onOpenChange:d,...o,children:[e.jsx(W,{asChild:!0,autoFocus:o.open,children:a??e.jsx(e.Fragment,{})}),e.jsxs(_,{className:"flex flex-col gap-6 sm:max-w-md h-full",children:[e.jsxs(J,{className:"text-left",children:[e.jsx(X,{children:"Update stats group details"}),e.jsx(Y,{children:"Update the stats group details and save the changes"})]}),e.jsx(p,{}),e.jsx(v,{data:s,onSubmit:i,children:e.jsxs($,{className:"gap-2 pt-2 sm:space-x-0",children:[e.jsx(ee,{asChild:!0,children:e.jsx(m,{type:"button",variant:"outline",children:"Cancel"})}),e.jsxs(m,{disabled:l,children:[l&&e.jsx(P,{className:"mr-2 size-4 animate-spin","aria-hidden":"true"}),"Save"]})]})})]})]})},Oe=({data:s})=>e.jsx(e.Fragment,{children:e.jsxs(D,{children:[e.jsx(z,{asChild:!0,children:e.jsx("div",{children:e.jsx(m,{"aria-label":"Open menu",variant:"ghost",className:"flex size-8 p-0 data-[state=open]:bg-muted",children:e.jsx(se,{className:"size-4","aria-hidden":"true"})})})}),e.jsxs(H,{align:"end",className:"w-40",children:[e.jsx(M,{children:"Actions"}),s.hash&&e.jsx(N,{data:s,triggerButton:e.jsx(A,{onSelect:a=>a.preventDefault(),children:"Edit"})})]})]})}),T=[{id:"hash",accessorKey:"hash",cell:({row:s})=>e.jsx(C,{className:"border-none",initialValue:s.original.hash,readonly:!0,initialMode:"hex"}),meta:{label:"Hash",variant:"text",placeholder:"Search by Hash (Hex)"},enableColumnFilter:!0},{id:"unitId",accessorKey:"unitId",meta:{label:"Unit",variant:"multiSelect"},enableColumnFilter:!0},{id:"hitboxHash",accessorKey:"hitboxHash",cell:({row:s})=>{var a;return e.jsx(e.Fragment,{children:e.jsx(U,{to:"/units/info/hitboxes",search:{hash:(a=s.original.hitboxHash)==null?void 0:a.toString(16).toUpperCase()},children:e.jsx(C,{className:"border-none",initialValue:s.original.hitboxHash,readonly:!0,initialMode:"hex"})})})}}],Be=T.map(s=>s.accessorKey),Ke=[...T,...Object.keys(w.shape).filter(s=>!Be.includes(s)).map(s=>({accessorKey:s,header:s})),{id:"actions",size:40,cell:({row:s})=>{if(s.original.hash)return e.jsx(Oe,{data:s.original})}}];function Ve({}){return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(N,{triggerButton:e.jsx(g,{variant:"default",effect:"expandIcon",icon:ae,iconPlacement:"right",children:"Create"})})})}const qe=({unitId:s})=>{const{page:a,perPage:o,hashes:t,unitIds:d}=Le(location.search),c=S({...be({query:{Page:a,PerPage:o,Hashes:(t==null?void 0:t.map(n=>parseInt(n,16)))??void 0,UnitIds:s?[s]:d??void 0}})}),r=c==null?void 0:c.data,l=S({...Ce({query:{ListAll:!0}}),select:n=>{var f;return((f=n==null?void 0:n.items.filter(h=>h.units).flatMap(h=>h.units))==null?void 0:f.map(h=>({label:h.nameEnglish??"-",value:h.unitId.toString()})))??[]}});let i=Se.find(n=>n.id==="unitId");i!=null&&i.meta&&(i.meta.options=l.data),i&&s&&(i.enableColumnFilter=!1);const{table:x}=te({data:(r==null?void 0:r.items)??[],columns:Ke,initialState:{columnPinning:{right:["actions"],left:["hash"]},pagination:{pageIndex:1,pageSize:5}},pageCount:(r==null?void 0:r.totalPages)??0,shallow:!1});return e.jsx(ie,{table:x,children:e.jsx(re,{table:x,children:e.jsx(Ve,{})})})},Qe=({children:s,unitIds:a,...o})=>{const[t,d]=u.useState(!0),[c,r]=u.useState([]),l=j({...Pe(),onSuccess:i=>{E("Success",{description:"Export completed!"})}});return e.jsxs(Ne,{...o,children:[e.jsx(Te,{asChild:!0,children:s??e.jsx(g,{effect:"gooeyRight",icon:y,iconPlacement:"right",children:"Export"})}),e.jsxs(De,{children:[e.jsxs(ze,{children:[e.jsx(He,{children:"Export Projectile Info"}),e.jsx(Me,{children:"Export projectile info for this unit to working directory."})]}),e.jsx(Ae,{children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ee,{children:"Units"}),e.jsx(Fe,{disabled:!!a,className:"w-full",defaultValues:a,value:c,onChange:r,placeholder:a?void 0:"Select units..."})]}),e.jsxs("div",{className:"flex items-center space-x-4 rounded-md border p-4",children:[e.jsx(ve,{size:40}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:"Hot Reload"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Patch the compiled binary to a running RPCS3's memory."})]}),e.jsxs(F,{children:[e.jsx(I,{children:e.jsx(we,{disabled:!!a&&a.length>1,checked:t,onCheckedChange:d})}),!!a&&a.length>1&&e.jsx(k,{children:e.jsx("p",{children:"Only available for single unit"})})]})]}),e.jsx(p,{})]})}),e.jsx(Ue,{children:e.jsxs(g,{className:"w-full",effect:"expandIcon",variant:"default",icon:y,iconPlacement:"right",disabled:l.isPending,onClick:async()=>{l.mutate({body:{unitIds:c.map(i=>Number(i.value)),replaceWorking:!0,hotReload:t}})},children:[l.isPending&&e.jsx(ye.spinner,{className:"size-4 mr-2 animate-spin","aria-hidden":"true"}),"Export"]})})]})]})},ls=({unitId:s})=>e.jsx("div",{className:"flex flex-col gap-3",children:e.jsxs(L,{className:"col-span-full",children:[e.jsxs(R,{className:"flex flex-row justify-between",children:[e.jsxs("div",{children:[e.jsx(O,{className:"mb-2",children:"Projectiles"}),e.jsx(B,{children:s?"Projectiles associated with this unit":"All projectiles"})]}),e.jsx(Qe,{unitIds:s?[s]:void 0})]}),e.jsx(K,{children:e.jsx("div",{className:"space-y-4",children:e.jsx(qe,{unitId:s})})})]})});export{ls as P};
