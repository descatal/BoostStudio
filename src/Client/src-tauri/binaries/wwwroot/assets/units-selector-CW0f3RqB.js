import{r as i,j as n,c as m,k as ne}from"./index-_vJHe0oM.js";import{C as M,a as le,_ as ie,b as ue,c as fe,P as ce}from"./command-Cnu_HUkU.js";import{B as ae}from"./badge-BRKXVVmH.js";import{X as H}from"./x-C61GwT2n.js";import{u as oe}from"./useQuery-BdyAwn5H.js";import{g as de}from"./react-query.gen-KD5ZsEyq.js";function xe(r,l){const[c,o]=i.useState(r);return i.useEffect(()=>{const d=setTimeout(()=>o(r),l);return()=>{clearTimeout(d)}},[r,l]),c}function G(r,l){if(r.length===0)return{};if(!l)return{"":r};const c={};return r.forEach(o=>{const d=o[l]||"";c[d]||(c[d]=[]),c[d].push(o)}),c}function ve(r,l){const c=JSON.parse(JSON.stringify(r));for(const[o,d]of Object.entries(c))c[o]=d.filter(b=>!l.find(a=>a.value===b.value));return c}function ge(r,l){for(const[,c]of Object.entries(r))if(c.some(o=>l.find(d=>d.value===o.value)))return!0;return!1}const $=i.forwardRef(({className:r,...l},c)=>ce(d=>d.filtered.count===0)?n.jsx("div",{ref:c,className:m("py-6 text-center text-sm",r),"cmdk-empty":"",role:"presentation",...l}):null);$.displayName="CommandEmpty";const Y=i.forwardRef(({value:r,onChange:l,placeholder:c,defaultOptions:o=[],options:d,delay:b,onSearch:a,onSearchSync:g,loadingIndicator:y,emptyIndicator:j,maxSelected:L=Number.MAX_SAFE_INTEGER,onMaxSelected:h,hidePlaceholderWhenSelected:R,disabled:D,groupBy:E,className:Z,badgeClassName:B,selectFirstItem:W=!0,creatable:U=!1,triggerSearchOnFocus:T=!1,commandProps:u,inputProps:f,hideClearAllButton:S=!1},V)=>{const v=i.useRef(null),[N,J]=i.useState(!1),[p,X]=i.useState(!1),[q,z]=i.useState(!1),K=i.useRef(null),[s,I]=i.useState(r||[]),[O,C]=i.useState(G(o,E)),[w,Q]=i.useState(""),k=xe(w,b||500);i.useImperativeHandle(V,()=>({selectedValue:[...s],input:v.current,focus:()=>{var e;return(e=v==null?void 0:v.current)==null?void 0:e.focus()},reset:()=>I([])}),[s]);const F=e=>{K.current&&!K.current.contains(e.target)&&v.current&&!v.current.contains(e.target)&&(J(!1),v.current.blur())},_=i.useCallback(e=>{const t=s.filter(x=>x.value!==e.value);I(t),l==null||l(t)},[l,s]),P=i.useCallback(e=>{const t=v.current;t&&((e.key==="Delete"||e.key==="Backspace")&&t.value===""&&s.length>0&&(s[s.length-1].fixed||_(s[s.length-1])),e.key==="Escape"&&t.blur())},[_,s]);i.useEffect(()=>(N?(document.addEventListener("mousedown",F),document.addEventListener("touchend",F)):(document.removeEventListener("mousedown",F),document.removeEventListener("touchend",F)),()=>{document.removeEventListener("mousedown",F),document.removeEventListener("touchend",F)}),[N]),i.useEffect(()=>{r&&I(r)},[r]),i.useEffect(()=>{if(!d||a)return;const e=G(d||[],E);JSON.stringify(e)!==JSON.stringify(O)&&C(e)},[o,d,E,a,O]),i.useEffect(()=>{const e=()=>{const x=g==null?void 0:g(k);C(G(x||[],E))};(async()=>{!g||!N||(T&&e(),k&&e())})()},[k,E,N,T]),i.useEffect(()=>{const e=async()=>{z(!0);const x=await(a==null?void 0:a(k));C(G(x||[],E)),z(!1)};(async()=>{!a||!N||(T&&await e(),k&&await e())})()},[k,E,N,T]);const ee=()=>{if(!U||ge(O,[{value:w,label:w}])||s.find(t=>t.value===w))return;const e=n.jsx(M,{value:w,className:"cursor-pointer",onMouseDown:t=>{t.preventDefault(),t.stopPropagation()},onSelect:t=>{if(s.length>=L){h==null||h(s.length);return}Q("");const x=[...s,{value:t,label:t}];I(x),l==null||l(x)},children:`Create "${w}"`});if(!a&&w.length>0||a&&k.length>0&&!q)return e},te=i.useCallback(()=>{if(j)return a&&!U&&Object.keys(O).length===0?n.jsx(M,{value:"-",disabled:!0,children:j}):n.jsx($,{children:j})},[U,j,a,O]),se=i.useMemo(()=>ve(O,s),[O,s]),re=i.useCallback(()=>{if(u!=null&&u.filter)return u.filter;if(U)return(e,t)=>e.toLowerCase().includes(t.toLowerCase())?1:-1},[U,u==null?void 0:u.filter]);return n.jsxs(le,{ref:K,...u,onKeyDown:e=>{var t;P(e),(t=u==null?void 0:u.onKeyDown)==null||t.call(u,e)},className:m("h-auto overflow-visible bg-transparent",u==null?void 0:u.className),shouldFilter:(u==null?void 0:u.shouldFilter)!==void 0?u.shouldFilter:!a,filter:re(),children:[n.jsx("div",{className:m("min-h-10 rounded-md border border-input text-base ring-offset-background focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2 md:text-sm",{"px-3 py-2":s.length!==0,"cursor-text":!D&&s.length!==0},Z),onClick:()=>{var e;D||(e=v==null?void 0:v.current)==null||e.focus()},children:n.jsxs("div",{className:"relative flex flex-wrap gap-1",children:[s.map(e=>n.jsxs(ae,{className:m("data-[disabled]:bg-muted-foreground data-[disabled]:text-muted data-[disabled]:hover:bg-muted-foreground","data-[fixed]:bg-muted-foreground data-[fixed]:text-muted data-[fixed]:hover:bg-muted-foreground",B),"data-fixed":e.fixed,"data-disabled":D||void 0,children:[e.label,n.jsx("button",{type:"button",className:m("ml-1 rounded-full outline-none ring-offset-background focus:ring-2 focus:ring-ring focus:ring-offset-2",(D||e.fixed)&&"hidden"),onKeyDown:t=>{t.key==="Enter"&&_(e)},onMouseDown:t=>{t.preventDefault(),t.stopPropagation()},onClick:()=>_(e),children:n.jsx(H,{className:"h-3 w-3 text-muted-foreground hover:text-foreground"})})]},e.value)),n.jsx(ie.Input,{...f,ref:v,value:w,disabled:D,onValueChange:e=>{var t;Q(e),(t=f==null?void 0:f.onValueChange)==null||t.call(f,e)},onBlur:e=>{var t;p||J(!1),(t=f==null?void 0:f.onBlur)==null||t.call(f,e)},onFocus:e=>{var t;J(!0),(t=f==null?void 0:f.onFocus)==null||t.call(f,e)},placeholder:R&&s.length!==0?"":c,className:m("flex-1 bg-transparent outline-none placeholder:text-muted-foreground",{"w-full":R,"px-3 py-2":s.length===0,"ml-1":s.length!==0},f==null?void 0:f.className)}),n.jsx("button",{type:"button",onClick:()=>{I(s.filter(e=>e.fixed)),l==null||l(s.filter(e=>e.fixed))},className:m("absolute right-0 h-6 w-6 p-0",(S||D||s.length<1||s.filter(e=>e.fixed).length===s.length)&&"hidden"),children:n.jsx(H,{})})]})}),n.jsx("div",{className:"relative",children:N&&n.jsx(ue,{className:"absolute top-1 z-10 w-full rounded-md border bg-popover text-popover-foreground shadow-md outline-none animate-in",onMouseLeave:()=>{X(!1)},onMouseEnter:()=>{X(!0)},onMouseUp:()=>{var e;(e=v==null?void 0:v.current)==null||e.focus()},children:q?n.jsx(n.Fragment,{children:y}):n.jsxs(n.Fragment,{children:[te(),ee(),!W&&n.jsx(M,{value:"-",className:"hidden"}),Object.entries(se).map(([e,t])=>n.jsx(fe,{heading:e,className:"h-full overflow-auto",children:n.jsx(n.Fragment,{children:t.map(x=>n.jsx(M,{value:x.label,disabled:x.disable,onMouseDown:A=>{A.preventDefault(),A.stopPropagation()},onSelect:()=>{if(s.length>=L){h==null||h(s.length);return}Q("");const A=[...s,x];I(A),l==null||l(A)},className:m("cursor-pointer",x.disable&&"cursor-default text-muted-foreground"),children:x.label},x.value))})},e))]})})})]})});Y.displayName="MultipleSelector";function Ne({defaultValues:r=[],multiple:l=!1,className:c,...o}){const b=oe({...de({query:{ListAll:!0}}),select:a=>{var g;return(g=a.items)==null?void 0:g.flatMap(y=>{var j;return((j=y.units)==null?void 0:j.map(L=>({group:y.nameEnglish??"",label:L.nameEnglish??"",value:L.unitId.toString(),fixed:r==null?void 0:r.some(h=>h===L.unitId)})))??[]})}}).data??[];return i.useEffect(()=>{if((r==null?void 0:r.length)<=0||!o.onChange)return;const a=b.filter(g=>r==null?void 0:r.some(y=>y.toString()===g.value));o.onChange(a)},[r,b]),n.jsx(n.Fragment,{children:b.length>0&&n.jsx("div",{className:m(c??"w-full px-10"),children:n.jsx(Y,{maxSelected:l?Number.MAX_SAFE_INTEGER:1,onMaxSelected:()=>{ne("Max unit reached")},defaultOptions:b,placeholder:"Select units...",emptyIndicator:n.jsx("p",{className:"text-center text-lg leading-10 text-gray-600 dark:text-gray-400",children:"No results found."}),groupBy:"group",...o})})})}export{Ne as U};
