import{j as e,a1 as u,b as D,L as K,S as w,ag as R,ah as V,ai as q,aj as B,ak as Q}from"./index-_vJHe0oM.js";import{C as j,b as f,c as S,d as P,a as p}from"./card-5a8OwMZI.js";import{k as E,l as T,m as Z,n as _,o as $,q as J,r as W,s as X,t as Y,v as ee,D as se,c as ae,p as C,h as te,f as re,g as ne,P as ie,u as le,i as oe,j as ce}from"./react-icons.esm-CMH9-wE8.js";import{u as g}from"./useQuery-BdyAwn5H.js";import{t as de,u as me,v as he,w as ue,x as xe,g as je}from"./react-query.gen-KD5ZsEyq.js";import{t as pe,F as ge,a as fe,b as Se,c as be,d as v,f as we}from"./zod-KirBnuy0.js";import{u as Ce,z as h}from"./index-Cljsltwk.js";import{S as ve,b as Ne,c as ye,d as Ae,e as De,f as Pe}from"./hash-input-BmZZ7wAd.js";import{S as F,a as I,b as O,c as z,d as M,e as H,f as G,g as L,A as Te,Z as Fe,L as N}from"./AutoForm-Ct6SXXji.js";import{u as Ie}from"./use-media-query-DN786i_c.js";import{u as y}from"./useMutation-0UaTLUn9.js";import{h as Oe}from"./columns-BlpQJy-L.js";h.object({id:h.string(),ammoHash:h.number({coerce:!0}),unitId:h.number(),slotOrder:h.number()});const ze=h.object({ammoHash:h.number({coerce:!0}),unitId:h.number(),slotOrder:h.number()});D.createContext({ammoSlots:[],setAmmoSlots:()=>{}});const Me=({children:s,index:t,unitId:c,ammoOptions:i,...d})=>{const l=Ce({resolver:pe(ze),defaultValues:{ammoHash:void 0,unitId:c,slotOrder:t}});function r(n){console.log(n)}return e.jsx("div",{children:e.jsxs(F,{...d,children:[e.jsx(I,{asChild:!0,children:s}),e.jsxs(O,{className:"flex flex-col gap-6 sm:max-w-md",children:[e.jsxs(z,{className:"text-left",children:[e.jsxs(M,{children:["Ammo Slot ",t+1]}),e.jsx(H,{children:"Select the ammo to be assigned to the ammo slot when spawned."})]}),e.jsx(ge,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(r),children:[e.jsx(fe,{control:l.control,name:"ammoHash",render:({field:n})=>{var a;return e.jsxs(Se,{children:[e.jsx(be,{children:"Ammo Hash"}),e.jsx(v,{children:e.jsxs(ve,{onValueChange:n.onChange,defaultValue:(a=n.value)==null?void 0:a.toString(),children:[e.jsx(v,{children:e.jsx(Ne,{className:"capitalize",children:e.jsx(ye,{placeholder:"Select ammo"})})}),e.jsx(Ae,{children:e.jsx(De,{children:i.map(m=>e.jsx(Pe,{value:m.toString(),className:"capitalize",children:m},m))})})]})}),e.jsx(we,{})]})}}),e.jsx(G,{className:"gap-2 pt-2 sm:space-x-0",children:e.jsx(L,{asChild:!0,children:e.jsx(u,{type:"button",variant:"outline",children:"Cancel"})})})]})})]})]})})},He=({unitId:s})=>{var l,r;const t=g({...de({path:{unitId:s}})}),c=g({...me({query:{UnitIds:[s]}})}),i=((l=t.data)==null?void 0:l.ammoSlots)??[],d=((r=c.data)==null?void 0:r.items.map(n=>n.hash))??[];return e.jsxs(j,{className:"col-span-full",children:[e.jsxs(f,{children:[e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-between space-y-2",children:e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Ammo Slots"})})}),e.jsx(P,{children:"The ammo assigned to each ammo slot when spawning this unit."})]}),e.jsx(p,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:Array.from({length:4},(n,a)=>{var m,o;return typeof i[a]>"u"?e.jsx("div",{children:e.jsx("div",{className:"h-full w-full",children:e.jsx(j,{className:"flex h-full items-center justify-center",children:e.jsx(p,{children:e.jsx(Me,{index:a,unitId:s,ammoOptions:d,children:e.jsx(u,{className:"mt-5",variant:"ghost",children:e.jsx(E,{className:"h-6 w-6"})})})})})})},a):e.jsx("div",{children:e.jsxs(j,{children:[e.jsx(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(S,{className:"w-full text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{children:["Ammo Slot ",a+1]}),e.jsx("div",{className:"flex items-center gap-3"})]})})}),e.jsx(p,{children:e.jsx(K,{to:"/units/$unitId/info/ammo",params:{unitId:s.toString()},search:{hash:(m=i[a])==null?void 0:m.ammoHash},children:e.jsx("div",{className:"text-2xl font-bold",children:(o=i[a])==null?void 0:o.ammoHash})})})]})},a)})})})]})},Ge=new Fe(T),A=({data:s,children:t,onSubmit:c})=>e.jsx(Te,{schema:Ge,defaultValues:s,onSubmit:i=>{c({...i,id:i.id})},formProps:{className:"px-2 overflow-auto"},withSubmit:!t,children:t}),U=({data:s,triggerButton:t,...c})=>{const[i,d]=D.useState(!1),l=y({...he(),onSuccess:()=>()=>d(!1)}),r=y({...ue(),onSuccess:()=>()=>d(!1)}),n=l.isPending||r.isPending,a=o=>{s?r.mutate({path:{id:o.id.toString()},body:o}):l.mutate({body:o})};return Ie("(min-width: 640px)")?e.jsxs(F,{open:i,onOpenChange:d,...c,children:[e.jsx(I,{asChild:!0,children:t??e.jsx(e.Fragment,{})}),e.jsxs(O,{className:"flex flex-col gap-6 sm:max-w-md",children:[e.jsxs(z,{className:"text-left",children:[e.jsx(M,{children:s?"Update":"Create"}),e.jsxs(H,{children:[s?"Update existing":"Create new"," stats group entry"]})]}),e.jsx(w,{}),e.jsx(A,{data:s,onSubmit:a,children:e.jsxs(G,{className:"gap-2 pt-2 sm:space-x-0",children:[e.jsx(L,{asChild:!0,children:e.jsx(u,{type:"button",variant:"outline",children:"Cancel"})}),e.jsxs(u,{disabled:n,children:[n&&e.jsx(N,{className:"mr-2 size-4 animate-spin","aria-hidden":"true"}),"Save"]})]})})]})]}):e.jsxs(Z,{open:i,onOpenChange:d,...c,children:[e.jsx(_,{asChild:!0,autoFocus:c.open,children:t??e.jsx(e.Fragment,{})}),e.jsxs($,{className:"flex flex-col gap-6 sm:max-w-md h-full",children:[e.jsxs(J,{className:"text-left",children:[e.jsx(W,{children:"Update stats group details"}),e.jsx(X,{children:"Update the stats group details and save the changes"})]}),e.jsx(w,{}),e.jsx(A,{data:s,onSubmit:a,children:e.jsxs(Y,{className:"gap-2 pt-2 sm:space-x-0",children:[e.jsx(ee,{asChild:!0,children:e.jsx(u,{type:"button",variant:"outline",children:"Cancel"})}),e.jsxs(u,{disabled:n,children:[n&&e.jsx(N,{className:"mr-2 size-4 animate-spin","aria-hidden":"true"}),"Save"]})]})})]})]})},Le=({data:s})=>e.jsx(e.Fragment,{children:e.jsxs(R,{children:[e.jsx(V,{asChild:!0,children:e.jsx("div",{children:e.jsx(u,{"aria-label":"Open menu",variant:"ghost",className:"flex size-8 p-0 data-[state=open]:bg-muted",children:e.jsx(se,{className:"size-4","aria-hidden":"true"})})})}),e.jsxs(q,{align:"end",className:"w-40",children:[e.jsx(B,{children:"Actions"}),s.id&&e.jsx(U,{data:s,triggerButton:e.jsx(Q,{onSelect:t=>t.preventDefault(),children:"Edit"})})]})]})}),k=[{id:"unitId",accessorKey:"unitId",meta:{label:"Unit",variant:"multiSelect"},enableColumnFilter:!0}],Ue=k.map(s=>s.accessorKey),ke=[...k,...Object.keys(T.shape).filter(s=>!Ue.includes(s)).map(s=>({accessorKey:s,header:s})),{id:"actions",size:40,cell:({row:s})=>{if(s.original.id)return e.jsx(Le,{data:s.original})}}],Ke={...te,ids:C(ne),unitIds:C(re)},Re={ids:"id",unitIds:"unitId"},Ve=ae(Ke,{urlKeys:Re});function qe({}){return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(U,{triggerButton:e.jsxs(u,{variant:"default",size:"sm",children:[e.jsx(ie,{className:"size-2","aria-hidden":"true"}),"Create"]})})})}const Be=({unitId:s})=>{const{page:t,perPage:c,ids:i,unitIds:d}=Ve(location.search),l=g({...xe({query:{Page:t,PerPage:c,Ids:i??void 0,UnitIds:s?[s]:d??void 0}})}),r=l==null?void 0:l.data,n=g({...je({query:{ListAll:!0}}),select:o=>{var b;return((b=o==null?void 0:o.items.filter(x=>x.units).flatMap(x=>x.units))==null?void 0:b.map(x=>({label:x.nameEnglish??"-",value:x.unitId.toString()})))??[]}});let a=Oe.find(o=>o.id==="unitId");a!=null&&a.meta&&(a.meta.options=n.data),a&&s&&(a.enableColumnFilter=!1);const{table:m}=le({data:(r==null?void 0:r.items)??[],columns:ke,initialState:{columnPinning:{right:["actions"],left:["id"]},pagination:{pageIndex:1,pageSize:5}},pageCount:(r==null?void 0:r.totalPages)??0,shallow:!1});return e.jsx(oe,{table:m,children:e.jsx(ce,{table:m,children:e.jsx(qe,{})})})},ts=({unitId:s})=>e.jsxs("div",{className:"flex flex-col gap-3",children:[s&&e.jsx(He,{unitId:s}),e.jsxs(j,{className:"col-span-full",children:[e.jsxs(f,{children:[e.jsx(S,{children:"Stat Groups"}),e.jsx(P,{children:"Stat groups associated with this unit."})]}),e.jsx(p,{children:e.jsx("div",{className:"space-y-4",children:e.jsx(Be,{unitId:s})})})]})]});export{ts as S};
