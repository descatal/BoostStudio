import{j as e,b as w,S as x,a1 as h,ag as D,ah as T,ai as z,aj as I,ak as M,k as H}from"./index-_vJHe0oM.js";import{C as E,b as F,c as k,d as R,a as U}from"./card-5a8OwMZI.js";import{c as B,p as f,h as L,f as O,g as K,y as v,m as q,n as Q,o as V,q as Z,r as G,s as W,t as _,v as J,D as X,P as Y,u as $,i as ee,j as se}from"./react-icons.esm-CMH9-wE8.js";import{A as ae,Z as te,S as ne,a as re,b as ie,c as oe,d as le,e as ce,f as de,g as me,L as C}from"./AutoForm-Ct6SXXji.js";import{u as he}from"./use-media-query-DN786i_c.js";import{u as p}from"./useMutation-0UaTLUn9.js";import{G as ue,H as xe,u as pe,g as je,I as ge}from"./react-query.gen-KD5ZsEyq.js";import{H as fe}from"./hash-input-BmZZ7wAd.js";import{E as j}from"./enhanced-button-CUT0MAbl.js";import{u as b}from"./useQuery-BdyAwn5H.js";import{I as Ce}from"./icons-stbk7nY0.js";import{M as be,S as Se}from"./index-MRitm8At.js";import{C as Ae,a as ye,B as S,b as we,c as ve,d as Ne,h as Pe,e as De,f as Te}from"./index-CH22QDEB.js";const ze={...L,hashes:f(K),unitIds:f(O)},Ie={hashes:"hash",unitIds:"unitId"},Me=B(ze,{urlKeys:Ie}),He=new te(v),A=({data:s,onSubmit:t,children:n})=>e.jsx(ae,{schema:He,defaultValues:{...s,hash:BigInt((s==null?void 0:s.hash)??0)},onSubmit:a=>{t(s?{...a,hash:Number(a.hash)}:a)},formProps:{className:"px-2 overflow-auto"},withSubmit:!n,children:n}),N=({data:s,triggerButton:t,...n})=>{const[a,i]=w.useState(!1),c=p({...ue(),onSuccess:()=>()=>i(!1)}),o=p({...xe(),onSuccess:()=>()=>i(!1)}),d=c.isPending||o.isPending,l=r=>{s?o.mutate({path:{hash:r.hash},body:r}):c.mutate({body:r})};return he("(min-width: 640px)")?e.jsxs(ne,{open:a,onOpenChange:i,...n,children:[e.jsx(re,{asChild:!0,children:t??e.jsx(e.Fragment,{})}),e.jsxs(ie,{className:"flex flex-col gap-6 sm:max-w-md",children:[e.jsxs(oe,{className:"text-left",children:[e.jsx(le,{children:s?"Update":"Create"}),e.jsxs(ce,{children:[s?"Update existing":"Create new"," ammo entry"]})]}),e.jsx(x,{}),e.jsx(A,{data:s,onSubmit:l,children:e.jsxs(de,{className:"gap-2 pt-2 sm:space-x-0",children:[e.jsx(me,{asChild:!0,children:e.jsx(h,{type:"button",variant:"outline",children:"Cancel"})}),e.jsxs(h,{disabled:d,children:[d&&e.jsx(C,{className:"mr-2 size-4 animate-spin","aria-hidden":"true"}),"Save"]})]})})]})]}):e.jsxs(q,{open:a,onOpenChange:i,...n,children:[e.jsx(Q,{asChild:!0,autoFocus:n.open,children:t??e.jsx(e.Fragment,{})}),e.jsxs(V,{className:"flex flex-col gap-6 sm:max-w-md h-full",children:[e.jsxs(Z,{className:"text-left",children:[e.jsx(G,{children:"Update stats group details"}),e.jsx(W,{children:"Update the stats group details and save the changes"})]}),e.jsx(x,{}),e.jsx(A,{data:s,onSubmit:l,children:e.jsxs(_,{className:"gap-2 pt-2 sm:space-x-0",children:[e.jsx(J,{asChild:!0,children:e.jsx(h,{type:"button",variant:"outline",children:"Cancel"})}),e.jsxs(h,{disabled:d,children:[d&&e.jsx(C,{className:"mr-2 size-4 animate-spin","aria-hidden":"true"}),"Save"]})]})})]})]})},Ee=({data:s})=>e.jsx(e.Fragment,{children:e.jsxs(D,{children:[e.jsx(T,{asChild:!0,children:e.jsx("div",{children:e.jsx(h,{"aria-label":"Open menu",variant:"ghost",className:"flex size-8 p-0 data-[state=open]:bg-muted",children:e.jsx(X,{className:"size-4","aria-hidden":"true"})})})}),e.jsxs(z,{align:"end",className:"w-40",children:[e.jsx(I,{children:"Actions"}),s.hash&&e.jsx(N,{data:s,triggerButton:e.jsx(M,{onSelect:t=>t.preventDefault(),children:"Edit"})})]})]})}),P=[{id:"hash",accessorKey:"hash",cell:({row:s})=>e.jsx(fe,{className:"border-none",initialValue:s.original.hash,readonly:!0,initialMode:"hex"}),meta:{label:"Hash",variant:"text",placeholder:"Search by Hash (Hex)"},enableColumnFilter:!0},{id:"unitId",accessorKey:"unitId",meta:{label:"Unit",variant:"multiSelect"},enableColumnFilter:!0}],Fe=P.map(s=>s.accessorKey),y=[...P,...Object.keys(v.shape).filter(s=>!Fe.includes(s)).map(s=>({accessorKey:s,header:s})),{id:"actions",size:40,cell:({row:s})=>{if(s.original.hash)return e.jsx(Ee,{data:s.original})}}];function ke({}){return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(N,{triggerButton:e.jsx(j,{variant:"default",effect:"ringHover",icon:Y,iconPlacement:"right",children:"Create"})})})}const Re=({unitId:s})=>{const{page:t,perPage:n,hashes:a,unitIds:i}=Me(location.search),c=b({...pe({query:{Page:t,PerPage:n,Hash:(a==null?void 0:a.map(r=>parseInt(r,16)))??void 0,UnitIds:s?[s]:i??void 0}})}),o=c==null?void 0:c.data,d=b({...je({query:{ListAll:!0}}),select:r=>{var g;return((g=r==null?void 0:r.items.filter(m=>m.units).flatMap(m=>m.units))==null?void 0:g.map(m=>({label:m.nameEnglish??"-",value:m.unitId.toString()})))??[]}});let l=y.find(r=>r.id==="unitId");l!=null&&l.meta&&(l.meta.options=d.data),l&&s&&(l.enableColumnFilter=!1);const{table:u}=$({data:(o==null?void 0:o.items)??[],columns:y,initialState:{columnPinning:{right:["actions"],left:["hash"]},pagination:{pageIndex:1,pageSize:5}},pageCount:(o==null?void 0:o.totalPages)??0,shallow:!1});return e.jsx(ee,{table:u,children:e.jsx(se,{table:u,children:e.jsx(ke,{})})})},Ue=({children:s,...t})=>{const[n,a]=w.useState(!0),i=p({...ge(),onSuccess:c=>{H("Success",{description:"Export completed!"})}});return e.jsxs(Ae,{...t,children:[e.jsx(ye,{asChild:!0,children:s??e.jsx(j,{effect:"gooeyRight",icon:S,iconPlacement:"right",children:"Export"})}),e.jsxs(we,{children:[e.jsxs(ve,{children:[e.jsx(Ne,{children:"Export Ammo Info"}),e.jsx(Pe,{children:"Export ammo info for ALL units to working directory."})]}),e.jsx(De,{children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 rounded-md border p-4",children:[e.jsx(be,{size:40}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:"Hot Reload"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Patch the compiled binary to a running RPCS3's memory."})]}),e.jsx(Se,{checked:n,onCheckedChange:a})]}),e.jsx(x,{})]})}),e.jsx(Te,{children:e.jsxs(j,{className:"w-full",effect:"expandIcon",variant:"default",icon:S,iconPlacement:"right",disabled:i.isPending,onClick:async()=>{i.mutate({body:{replaceWorking:!0,hotReload:n}})},children:[i.isPending&&e.jsx(Ce.spinner,{className:"size-4 mr-2 animate-spin","aria-hidden":"true"}),"Export"]})})]})]})},Ye=({unitId:s})=>e.jsx("div",{className:"flex flex-col gap-3",children:e.jsxs(E,{className:"col-span-full",children:[e.jsxs(F,{className:"flex flex-row justify-between",children:[e.jsxs("div",{children:[e.jsx(k,{children:"Ammo"}),e.jsx(R,{children:s?"Ammo associated with this unit":"All ammo"})]}),e.jsx(Ue,{})]}),e.jsx(U,{children:e.jsx("div",{className:"space-y-4",children:e.jsx(Re,{unitId:s})})})]})});export{Ye as A};
